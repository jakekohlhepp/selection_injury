--------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /proj/kohlhepplab/projects/selection_injury/mkdata/log/01_03_mk_pre
> network.log
  log type:  text
 opened on:  28 Feb 2025, 11:25:52

. set more off 

. cap ssc install unique

. cap ssc install rangestat

. local print_pic ="yes"

. set scheme cleanplots 

. 
. *** Purpose: create dataset storing potential contact between workers
. 
. *** check that traffic officer I never work ot
. use data/working_expanded, clear

. 
. bys employee_name (analysis_workdate): assert job_class_title[1]==job_class_ti
> tle

. gen is_ot = varot_hours >0

. tab is_ot if job_class_title =="TRAF OFFICER II"

      is_ot |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    345,537       87.37       87.37
          1 |     49,943       12.63      100.00
------------+-----------------------------------
      Total |    395,480      100.00

. count if is_ot==1 & job_class_title =="TRAF OFFICER I"
  1

. assert r(N)==1

. ** there is only one documented day where a traffic officer i works overtime
. 
. *** store age from very raw data.
. use data/pay_data, clear

. assert !missing(yearsoldonworkdate )

. gen analysis_workdate=dofc(work_date)

. * age as of 20150101 - check that all ages agree
. bys employee_name (yearsoldonworkdate analysis_workdate): gen age_20150101 = y
> earsoldonworkdate-(analysis_workdate-d(01jan2015))/365.25

. assert !missing(age_20150101)

. * age is correct to within a week
. bys employee_name (age_20150101 analysis_workdate): assert round((age_20150101
> -age_20150101[1])*52)==0

. bys employee_name (analysis_workdate): replace age_20150101 = age_20150101[1]
(449834 real changes made)

. keep employee_name age_2015010

. duplicates drop

Duplicates in terms of all variables

(450,028 observations deleted)

. isid employee_name

. tempfile age

. save `age'
file /work/appscr/statawork/kohlhepp/St3461303.000007 saved as .dta format

. 
. 
. 
. use data/01_02_fornetwork, clear

. isid employee_name geo_div analysis_workdate

. * add on employee details
. merge m:1 employee_name using data/employee_data, keepusing(job_class_title)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            11
        from master                         0  (_merge==1)
        from using                         11  (_merge==2)

    Matched                           317,373  (_merge==3)
    -----------------------------------------

. assert _m!=1

. drop if _m==2
(11 observations deleted)

. drop _m

. 
. 
. *** limit to only traffic officer IIs, because they are the only ones who can 
> have OT assigned in their name
. bys employee_name (analysis_workdate): assert job_class_title[1]==job_class_ti
> tle

. keep if job_class_title =="TRAF OFFICER II"
(15,849 observations deleted)

. drop job_class_title

. 
. 
. preserve 

. *** step 1: compute exposure
. bys geo_div analysis_workdate (employee_name): gen exposure = 1/(_N-1)
(516 missing values generated)

. 
. ** Step 2: cast to div-day
. destring employee_name, ignore("EMPLOYEE ") gen(emp_num)
employee_name: characters E M P L O Y space removed; emp_num generated as int

. drop employee_name

. reshape wide exposure, i(geo_div analysis_workdate) j(emp_num)
(j = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 2
> 8 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 46 47 48 49 51 52 53 54 55 5
> 6 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 75 76 77 78 79 80 81 82 8
> 3 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 
> 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 12
> 6 127 128 129 130 131 132 133 134 136 137 138 139 140 141 142 143 144 145 146 
> 147 148 149 150 151 153 154 155 156 157 158 159 160 161 162 163 164 165 167 16
> 8 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 
> 188 189 190 191 192 193 195 196 197 198 199 200 201 202 203 204 205 206 207 20
> 8 209 210 212 213 214 215 216 217 218 220 222 223 224 225 226 227 228 230 231 
> 232 233 235 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 25
> 3 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 
> 273 274 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 29
> 3 294 296 297 298 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 
> 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 33
> 4 335 336 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 
> 355 356 357 358 359 362 363 364 365 366 367 368 369 370 371 372 373 374 375 37
> 6 377 378 379 380 381 382 383 384 385 386 387 388 389 391 392 393 394 395 396 
> 397 398 399 400 401 402 403 404 405 406 408 409 410 415 417 418 419 420 421 42
> 2 423 424 425 426 427 428 429 430 431 432 433 434 435 437 438 439 440 441 442 
> 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 46
> 2 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 
> 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 498 499 500 501 50
> 2 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 
> 522 525 526 528 529 530 532 533 534 535 536 537 538 539 540 541 542 543 544 54
> 6 547 548 549 550 551 552 553 554 555 557 558 559 562 563 565 566 567 570 571 
> 572 574 575 576 577 578 579 581 585 586 587 588 589 590 592 596 599 601 602 60
> 7 608 610 611 612 613 614 615 616 619 620 621 624 627 628 629 631 632 633 634 
> 635 636 637 641 646 650 656 658 661 662 664 665 666 667 675 676 677 678 679 68
> 3 684 687 688 690 691)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations          301,524   ->   13,561      
Number of variables                   4   ->   599         
j variable (597 values)         emp_num   ->   (dropped)
xij variables:
                               exposure   ->   exposure0 exposure1 ... exposure6
> 91
-----------------------------------------------------------------------------

. 
. * set exposure variable to 0 when missing
. foreach var of varlist exposure* {
  2.     replace `var' = 0 if missing(`var')
  3. }
(13,327 real changes made)
(13,012 real changes made)
(12,982 real changes made)
(13,012 real changes made)
(13,014 real changes made)
(12,871 real changes made)
(13,454 real changes made)
(12,877 real changes made)
(13,005 real changes made)
(12,948 real changes made)
(12,929 real changes made)
(13,011 real changes made)
(13,007 real changes made)
(13,011 real changes made)
(12,926 real changes made)
(13,005 real changes made)
(13,003 real changes made)
(13,370 real changes made)
(13,319 real changes made)
(12,991 real changes made)
(13,006 real changes made)
(12,967 real changes made)
(13,018 real changes made)
(12,955 real changes made)
(13,004 real changes made)
(13,052 real changes made)
(13,308 real changes made)
(12,885 real changes made)
(12,994 real changes made)
(13,299 real changes made)
(13,364 real changes made)
(12,970 real changes made)
(13,288 real changes made)
(13,018 real changes made)
(12,933 real changes made)
(12,887 real changes made)
(13,004 real changes made)
(13,003 real changes made)
(12,990 real changes made)
(13,224 real changes made)
(13,009 real changes made)
(13,010 real changes made)
(13,011 real changes made)
(12,868 real changes made)
(12,866 real changes made)
(13,006 real changes made)
(12,903 real changes made)
(12,992 real changes made)
(12,959 real changes made)
(12,911 real changes made)
(13,462 real changes made)
(13,221 real changes made)
(12,995 real changes made)
(12,970 real changes made)
(13,007 real changes made)
(13,393 real changes made)
(12,977 real changes made)
(13,000 real changes made)
(12,986 real changes made)
(13,000 real changes made)
(13,441 real changes made)
(13,011 real changes made)
(13,009 real changes made)
(12,917 real changes made)
(12,986 real changes made)
(13,118 real changes made)
(12,987 real changes made)
(12,978 real changes made)
(12,988 real changes made)
(13,002 real changes made)
(12,996 real changes made)
(12,978 real changes made)
(13,521 real changes made)
(13,010 real changes made)
(13,004 real changes made)
(13,351 real changes made)
(13,011 real changes made)
(12,899 real changes made)
(12,932 real changes made)
(13,541 real changes made)
(13,011 real changes made)
(13,001 real changes made)
(13,005 real changes made)
(13,542 real changes made)
(13,008 real changes made)
(12,936 real changes made)
(12,912 real changes made)
(12,999 real changes made)
(13,014 real changes made)
(12,973 real changes made)
(13,005 real changes made)
(13,005 real changes made)
(12,997 real changes made)
(13,000 real changes made)
(13,010 real changes made)
(13,399 real changes made)
(12,925 real changes made)
(12,975 real changes made)
(12,964 real changes made)
(13,010 real changes made)
(12,976 real changes made)
(12,993 real changes made)
(12,899 real changes made)
(13,000 real changes made)
(12,958 real changes made)
(13,003 real changes made)
(13,533 real changes made)
(12,973 real changes made)
(12,894 real changes made)
(13,007 real changes made)
(13,180 real changes made)
(13,004 real changes made)
(13,465 real changes made)
(12,948 real changes made)
(12,986 real changes made)
(13,007 real changes made)
(13,010 real changes made)
(12,985 real changes made)
(12,940 real changes made)
(12,961 real changes made)
(12,887 real changes made)
(12,856 real changes made)
(12,929 real changes made)
(12,980 real changes made)
(12,975 real changes made)
(13,199 real changes made)
(13,005 real changes made)
(13,005 real changes made)
(12,984 real changes made)
(12,904 real changes made)
(13,005 real changes made)
(13,010 real changes made)
(13,012 real changes made)
(12,993 real changes made)
(13,011 real changes made)
(12,993 real changes made)
(12,973 real changes made)
(12,936 real changes made)
(12,900 real changes made)
(12,984 real changes made)
(12,990 real changes made)
(12,959 real changes made)
(13,003 real changes made)
(13,219 real changes made)
(13,412 real changes made)
(13,015 real changes made)
(13,007 real changes made)
(13,370 real changes made)
(13,109 real changes made)
(13,004 real changes made)
(12,981 real changes made)
(12,996 real changes made)
(12,989 real changes made)
(13,005 real changes made)
(13,120 real changes made)
(13,012 real changes made)
(13,010 real changes made)
(12,994 real changes made)
(13,004 real changes made)
(12,989 real changes made)
(13,007 real changes made)
(13,000 real changes made)
(12,994 real changes made)
(12,982 real changes made)
(12,994 real changes made)
(12,983 real changes made)
(12,957 real changes made)
(13,528 real changes made)
(13,004 real changes made)
(13,105 real changes made)
(13,009 real changes made)
(12,994 real changes made)
(13,004 real changes made)
(12,960 real changes made)
(12,984 real changes made)
(12,951 real changes made)
(13,377 real changes made)
(12,997 real changes made)
(13,007 real changes made)
(12,919 real changes made)
(12,948 real changes made)
(13,011 real changes made)
(12,998 real changes made)
(13,009 real changes made)
(12,983 real changes made)
(12,942 real changes made)
(13,003 real changes made)
(12,937 real changes made)
(13,010 real changes made)
(13,547 real changes made)
(13,007 real changes made)
(12,988 real changes made)
(12,924 real changes made)
(12,853 real changes made)
(13,272 real changes made)
(13,273 real changes made)
(13,013 real changes made)
(13,002 real changes made)
(12,902 real changes made)
(13,007 real changes made)
(12,934 real changes made)
(13,004 real changes made)
(12,959 real changes made)
(13,012 real changes made)
(12,996 real changes made)
(13,009 real changes made)
(12,994 real changes made)
(13,010 real changes made)
(12,996 real changes made)
(12,997 real changes made)
(12,949 real changes made)
(13,006 real changes made)
(13,252 real changes made)
(12,943 real changes made)
(13,221 real changes made)
(12,978 real changes made)
(12,958 real changes made)
(13,009 real changes made)
(12,952 real changes made)
(13,003 real changes made)
(12,996 real changes made)
(13,011 real changes made)
(12,949 real changes made)
(12,979 real changes made)
(12,991 real changes made)
(12,984 real changes made)
(12,979 real changes made)
(12,929 real changes made)
(13,005 real changes made)
(13,010 real changes made)
(12,879 real changes made)
(12,996 real changes made)
(13,048 real changes made)
(13,028 real changes made)
(12,945 real changes made)
(12,919 real changes made)
(13,011 real changes made)
(12,919 real changes made)
(12,991 real changes made)
(13,003 real changes made)
(12,944 real changes made)
(13,004 real changes made)
(13,101 real changes made)
(12,986 real changes made)
(12,951 real changes made)
(13,002 real changes made)
(12,946 real changes made)
(13,013 real changes made)
(12,998 real changes made)
(12,940 real changes made)
(12,992 real changes made)
(12,819 real changes made)
(12,988 real changes made)
(12,968 real changes made)
(12,989 real changes made)
(13,504 real changes made)
(12,969 real changes made)
(13,275 real changes made)
(12,918 real changes made)
(12,920 real changes made)
(13,130 real changes made)
(12,944 real changes made)
(12,947 real changes made)
(13,005 real changes made)
(12,928 real changes made)
(12,948 real changes made)
(13,083 real changes made)
(13,016 real changes made)
(12,983 real changes made)
(12,999 real changes made)
(12,994 real changes made)
(12,864 real changes made)
(12,921 real changes made)
(12,994 real changes made)
(12,958 real changes made)
(12,968 real changes made)
(13,011 real changes made)
(13,010 real changes made)
(13,077 real changes made)
(13,002 real changes made)
(13,005 real changes made)
(12,895 real changes made)
(12,934 real changes made)
(12,968 real changes made)
(12,961 real changes made)
(13,020 real changes made)
(13,010 real changes made)
(13,004 real changes made)
(13,004 real changes made)
(13,085 real changes made)
(12,961 real changes made)
(13,002 real changes made)
(12,800 real changes made)
(13,384 real changes made)
(13,008 real changes made)
(12,981 real changes made)
(12,998 real changes made)
(13,008 real changes made)
(13,010 real changes made)
(12,995 real changes made)
(13,000 real changes made)
(12,993 real changes made)
(12,987 real changes made)
(12,975 real changes made)
(12,971 real changes made)
(12,975 real changes made)
(13,009 real changes made)
(12,990 real changes made)
(13,005 real changes made)
(13,002 real changes made)
(13,012 real changes made)
(12,878 real changes made)
(12,865 real changes made)
(13,068 real changes made)
(12,992 real changes made)
(13,008 real changes made)
(13,004 real changes made)
(12,999 real changes made)
(12,983 real changes made)
(13,503 real changes made)
(12,946 real changes made)
(13,047 real changes made)
(13,013 real changes made)
(12,903 real changes made)
(12,967 real changes made)
(13,010 real changes made)
(12,943 real changes made)
(12,981 real changes made)
(13,009 real changes made)
(12,975 real changes made)
(13,011 real changes made)
(13,002 real changes made)
(12,933 real changes made)
(12,943 real changes made)
(13,496 real changes made)
(12,960 real changes made)
(12,953 real changes made)
(12,971 real changes made)
(13,050 real changes made)
(12,983 real changes made)
(12,965 real changes made)
(12,916 real changes made)
(12,967 real changes made)
(13,014 real changes made)
(12,964 real changes made)
(12,943 real changes made)
(13,009 real changes made)
(12,965 real changes made)
(13,015 real changes made)
(13,013 real changes made)
(13,006 real changes made)
(13,008 real changes made)
(12,995 real changes made)
(12,972 real changes made)
(12,823 real changes made)
(12,952 real changes made)
(13,010 real changes made)
(13,313 real changes made)
(12,957 real changes made)
(12,933 real changes made)
(13,098 real changes made)
(12,983 real changes made)
(13,103 real changes made)
(12,932 real changes made)
(12,993 real changes made)
(12,961 real changes made)
(12,995 real changes made)
(12,997 real changes made)
(13,003 real changes made)
(13,007 real changes made)
(13,014 real changes made)
(13,034 real changes made)
(13,003 real changes made)
(12,929 real changes made)
(12,912 real changes made)
(12,933 real changes made)
(13,034 real changes made)
(12,942 real changes made)
(13,254 real changes made)
(12,998 real changes made)
(12,981 real changes made)
(13,002 real changes made)
(13,008 real changes made)
(13,062 real changes made)
(13,001 real changes made)
(12,972 real changes made)
(13,509 real changes made)
(12,868 real changes made)
(13,002 real changes made)
(13,005 real changes made)
(13,000 real changes made)
(13,231 real changes made)
(13,010 real changes made)
(12,968 real changes made)
(12,983 real changes made)
(13,006 real changes made)
(12,965 real changes made)
(13,027 real changes made)
(12,971 real changes made)
(13,083 real changes made)
(12,944 real changes made)
(13,055 real changes made)
(12,971 real changes made)
(13,009 real changes made)
(12,992 real changes made)
(12,963 real changes made)
(12,787 real changes made)
(13,000 real changes made)
(12,999 real changes made)
(12,977 real changes made)
(12,934 real changes made)
(13,006 real changes made)
(13,003 real changes made)
(12,919 real changes made)
(12,913 real changes made)
(12,983 real changes made)
(13,004 real changes made)
(12,940 real changes made)
(12,994 real changes made)
(12,936 real changes made)
(13,424 real changes made)
(12,998 real changes made)
(13,341 real changes made)
(12,929 real changes made)
(12,990 real changes made)
(12,994 real changes made)
(12,970 real changes made)
(12,938 real changes made)
(12,949 real changes made)
(12,968 real changes made)
(12,899 real changes made)
(12,904 real changes made)
(13,008 real changes made)
(12,983 real changes made)
(12,993 real changes made)
(13,009 real changes made)
(12,903 real changes made)
(12,878 real changes made)
(13,011 real changes made)
(13,035 real changes made)
(13,007 real changes made)
(13,247 real changes made)
(12,976 real changes made)
(13,002 real changes made)
(12,821 real changes made)
(12,993 real changes made)
(13,417 real changes made)
(13,074 real changes made)
(13,189 real changes made)
(12,992 real changes made)
(13,006 real changes made)
(13,010 real changes made)
(12,895 real changes made)
(13,005 real changes made)
(12,990 real changes made)
(12,981 real changes made)
(13,105 real changes made)
(12,969 real changes made)
(12,971 real changes made)
(12,965 real changes made)
(12,994 real changes made)
(12,968 real changes made)
(13,006 real changes made)
(13,062 real changes made)
(12,997 real changes made)
(12,987 real changes made)
(12,956 real changes made)
(12,995 real changes made)
(12,969 real changes made)
(13,012 real changes made)
(12,974 real changes made)
(12,952 real changes made)
(12,922 real changes made)
(13,017 real changes made)
(12,985 real changes made)
(13,331 real changes made)
(12,988 real changes made)
(12,933 real changes made)
(13,013 real changes made)
(13,007 real changes made)
(13,005 real changes made)
(12,937 real changes made)
(12,990 real changes made)
(12,988 real changes made)
(12,958 real changes made)
(12,991 real changes made)
(12,982 real changes made)
(12,920 real changes made)
(13,008 real changes made)
(12,977 real changes made)
(13,019 real changes made)
(12,996 real changes made)
(12,927 real changes made)
(13,311 real changes made)
(12,995 real changes made)
(12,983 real changes made)
(13,500 real changes made)
(12,942 real changes made)
(12,896 real changes made)
(12,970 real changes made)
(12,993 real changes made)
(12,978 real changes made)
(12,935 real changes made)
(12,988 real changes made)
(13,038 real changes made)
(12,769 real changes made)
(12,999 real changes made)
(12,949 real changes made)
(12,883 real changes made)
(13,013 real changes made)
(13,532 real changes made)
(12,991 real changes made)
(12,923 real changes made)
(13,250 real changes made)
(12,876 real changes made)
(13,323 real changes made)
(13,501 real changes made)
(13,229 real changes made)
(13,046 real changes made)
(13,038 real changes made)
(13,007 real changes made)
(12,993 real changes made)
(12,913 real changes made)
(12,972 real changes made)
(13,204 real changes made)
(12,994 real changes made)
(13,506 real changes made)
(13,502 real changes made)
(13,014 real changes made)
(13,039 real changes made)
(13,023 real changes made)
(12,860 real changes made)
(13,011 real changes made)
(13,052 real changes made)
(13,050 real changes made)
(12,984 real changes made)
(13,032 real changes made)
(13,007 real changes made)
(13,004 real changes made)
(13,247 real changes made)
(13,290 real changes made)
(13,184 real changes made)
(13,503 real changes made)
(13,518 real changes made)
(13,505 real changes made)
(13,177 real changes made)
(13,381 real changes made)
(13,221 real changes made)
(13,206 real changes made)
(13,512 real changes made)
(13,387 real changes made)
(13,255 real changes made)
(13,387 real changes made)
(13,336 real changes made)
(13,261 real changes made)
(13,340 real changes made)
(13,291 real changes made)
(13,506 real changes made)
(13,235 real changes made)
(13,511 real changes made)
(13,333 real changes made)
(13,223 real changes made)
(13,434 real changes made)
(13,250 real changes made)
(13,513 real changes made)
(13,376 real changes made)
(13,510 real changes made)
(13,244 real changes made)
(13,235 real changes made)
(13,503 real changes made)
(13,287 real changes made)
(13,346 real changes made)
(13,252 real changes made)
(13,223 real changes made)
(13,244 real changes made)
(13,507 real changes made)
(13,251 real changes made)
(13,339 real changes made)
(13,500 real changes made)
(13,492 real changes made)
(13,279 real changes made)
(13,510 real changes made)
(13,307 real changes made)
(13,408 real changes made)
(13,512 real changes made)
(13,512 real changes made)
(13,509 real changes made)
(13,507 real changes made)
(13,518 real changes made)
(13,510 real changes made)
(13,506 real changes made)
(13,512 real changes made)
(13,507 real changes made)
(13,510 real changes made)
(13,501 real changes made)
(13,496 real changes made)
(13,512 real changes made)

. 
. tempfile widediv

. save `widediv'
file /work/appscr/statawork/kohlhepp/St3461303.000009 saved as .dta format

. 
. *** Step 3: reattach and collapse to officer-date
. restore

. merge m:1 geo_div analysis_workdate using `widediv'

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           301,524  (_merge==3)
    -----------------------------------------

. assert _m==3

. drop _m

. 
. keep exposure* employee_name analysis_workdate

. compress
  variable analysis_workdate was double now int
  variable exposure587 was double now byte
  variable exposure677 was double now byte
  (6,030,480 bytes saved)

. 
. ** this is just because of memory issues on some computers.
. confirm variable exposure300

. confirm variable exposure0

. confirm variable exposure301

. confirm variable exposure691

. 
. preserve 

. keep employee_name analysis_workdate  exposure0 - exposure300

. collapse (sum) exposure*, by(employee_name analysis_workdate)

. tempfile half

. save `half'
file /work/appscr/statawork/kohlhepp/St3461303.00000b saved as .dta format

. restore

. 
. keep employee_name analysis_workdate  exposure301 - exposure691

. collapse (sum) exposure*, by(employee_name analysis_workdate)

. merge 1:1 employee_name analysis_workdate using `half'

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           301,355  (_merge==3)
    -----------------------------------------

. assert _m==3

. drop _m

. 
. *** Step 4: reattach to the fully expanded data that includes non-work days.
. merge 1:1 employee_name analysis_workdate using data/working_expanded

    Result                      Number of obs
    -----------------------------------------
    Not matched                       205,685
        from master                    33,877  (_merge==1)
        from using                    171,808  (_merge==2)

    Matched                           267,478  (_merge==3)
    -----------------------------------------

. keep if job_class_title =="TRAF OFFICER II"
(77,683 observations deleted)

. 
. assert _m!=1

. drop _m

. compress
  variable exposure351 was double now byte
  variable exposure406 was double now byte
  variable exposure526 was double now byte
  variable exposure562 was double now byte
  variable exposure563 was double now byte
  variable exposure586 was double now byte
  variable exposure587 was double now byte
  variable exposure588 was double now byte
  variable exposure599 was double now byte
  variable exposure613 was double now byte
  variable exposure615 was double now byte
  variable exposure624 was double now byte
  variable exposure628 was double now byte
  variable exposure632 was double now byte
  variable exposure641 was double now byte
  variable exposure656 was double now byte
  variable exposure658 was double now byte
  variable exposure662 was double now byte
  variable exposure666 was double now byte
  variable exposure667 was double now byte
  variable exposure675 was double now byte
  variable exposure676 was double now byte
  variable exposure677 was double now byte
  variable exposure678 was double now byte
  variable exposure679 was double now byte
  variable exposure683 was double now byte
  variable exposure684 was double now byte
  variable exposure687 was double now byte
  variable exposure688 was double now byte
  variable exposure690 was double now byte
  variable exposure691 was double now byte
  variable job_status was str19 now str15
  (87,401,080 bytes saved)

. 
. sort employee_name analysis_workdate

. foreach var of varlist exposure* {
  2.     replace `var' = 0 if missing(`var')                              
  3. 
. }
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)
(128,002 real changes made)

. 
. *  old code which does just all time cum. sum
. *sort employee_name analysis_workdate
.   * foreach var of varlist exposure* {
.    *     by employee_name: replace `var' = sum(`var')
.     *}
. 
. * 1000 encompasses the entire period.
. 
. foreach p in 30 90 180 1000 {
  2.     preserve
  3. 
.     * sum of exposure in p-day rolling window.
.     * looping over vars is because of memory/var constraints in some stata imp
> lementations.
.     foreach var of varlist exposure* {
  4.         rangestat (sum) roll`p'_`var' = `var', interval(analysis_workdate -
> `p' 0) by(employee_name)
  5.         drop `var'
  6.     }
  7.     
. 
.     *** remove those without observed work between january 1, 2015 and june 30
> , 2016
.     gen has_work= tot_hours>0 & analysis_workdate>=d(01jan2015) & analysis_wor
> kdate<=d(30jun2016)
  8.     bys employee_name (analysis_workdate): egen max_flag = max(has_work)
  9.     unique employee_name if max_flag==0
 10.     assert r(sum)==36
 11.     drop if max_flag==0
 12.     drop max_flag has_work
 13.     
.     *** when there is an injury, either the person worked normal hours or over
> time
.     replace varstandard_hours =0 if missing(varstandard_hours )
 14.     replace varot_hours  =0 if missing(varot_hours )
 15.     assert varstandard_hours >0 | varot_hours >0    if matched_injury==1
 16.     
.     ** construct tenure from original hire date and age from age on 20150101
.     merge m:1 employee_name using data/employee_data, keepusing(original_hire_
> date)
 17.     assert _m!=1
 18.     drop if _m==2
 19.     drop _m
 20.     assert !missing(original_hire_date)
 21.     gen tenure = (analysis_workdate - dofc(original_hire_date))/365.25
 22.     label variable tenure "Tenure (years)"
 23.     assert tenure>=0
 24.     
.     * for age: we have age on 20150101.
.     merge m:1 employee_name using `age'
 25.     assert _m!=1
 26.     drop if _m==2
 27.     drop _m
 28.     assert !missing(age_20150101 )
 29.     gen an_age = age_20150101 + (analysis_workdate-d(01jan2015))/365.25
 30.     
.     * rank by seniority many different ways
.     bys analysis_workdate (tenure employee_name): egen seniority_rank = rank(t
> enure), field
 31.     
.     
.     label variable max_rate "Wage"
 32.     label variable an_age "Age"
 33.     label variable seniority_rank "Seniority Rank in Org"
 34.     
.     
.     * create value holding date of first observed injury
.     bys employee_name matched_injury (analysis_workdate): gen first_inj_date =
>  analysis_workdate if matched_injury==1
 35.     bys employee_name (first_inj_date analysis_workdate): replace first_inj
> _date = first_inj_date[1]
 36.     
.     sort employee_name analysis_workdate
 37.     isid employee_name analysis_workdate
 38.     
.     ** note that currently exposure is as of the end of the listed date.
.     ** in general we want exposure as of the end of the previous date
.     
.     *** CAUTION: WHEN USING THIS DATA TO PLOT A NETWORK, WE MUST FIRST PURGE O
> UT EMPLOYEES THAT ARE NOT YET HIRED OR WHO WERE FIRED.
.     *** ROWS ARE ALREADY PURGED THIS WAY. SO AN EMPLOYEE IS ONLY IN THIS DATA 
> ON A DATE IF THEY ARE EMPLOYED
.     *** BUT COLUMNS ARE NOT! SO TO CORRECTLY GET A NETWORK ONE NEEDS TO DROP A
> LL EMPLOYEE COLUMNS THAT ARE NOT ROWS ON THAT DATE.
.     
.     drop empid
 39.     
.     export delimited data/01_03_pre_network_`p'.csv, replace
 40.     restore
 41. }
Number of unique values of employee_name is  36
Number of records is  11797
(11,797 observations deleted)
(0 real changes made)
(0 real changes made)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           201
        from master                         0  (_merge==1)
        from using                        201  (_merge==2)

    Matched                           383,683  (_merge==3)
    -----------------------------------------
(201 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           201
        from master                         0  (_merge==1)
        from using                        201  (_merge==2)

    Matched                           383,683  (_merge==3)
    -----------------------------------------
(201 observations deleted)
(383,447 missing values generated)
(128166 real changes made)
(file data/01_03_pre_network_30.csv not found)
file data/01_03_pre_network_30.csv saved
Number of unique values of employee_name is  36
Number of records is  11797
(11,797 observations deleted)
(0 real changes made)
(0 real changes made)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           201
        from master                         0  (_merge==1)
        from using                        201  (_merge==2)

    Matched                           383,683  (_merge==3)
    -----------------------------------------
(201 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           201
        from master                         0  (_merge==1)
        from using                        201  (_merge==2)

    Matched                           383,683  (_merge==3)
    -----------------------------------------
(201 observations deleted)
(383,447 missing values generated)
(128166 real changes made)
(file data/01_03_pre_network_90.csv not found)
file data/01_03_pre_network_90.csv saved
Number of unique values of employee_name is  36
Number of records is  11797
(11,797 observations deleted)
(0 real changes made)
(0 real changes made)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           201
        from master                         0  (_merge==1)
        from using                        201  (_merge==2)

    Matched                           383,683  (_merge==3)
    -----------------------------------------
(201 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           201
        from master                         0  (_merge==1)
        from using                        201  (_merge==2)

    Matched                           383,683  (_merge==3)
    -----------------------------------------
(201 observations deleted)
(383,447 missing values generated)
(128166 real changes made)
(file data/01_03_pre_network_180.csv not found)
file data/01_03_pre_network_180.csv saved
